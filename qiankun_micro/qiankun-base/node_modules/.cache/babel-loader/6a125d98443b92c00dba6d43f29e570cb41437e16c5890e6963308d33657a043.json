{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport { SandBoxType } from '../interfaces';\nfunction iter(obj, callbackFn) {\n  // eslint-disable-next-line guard-for-in, no-restricted-syntax\n  for (var prop in obj) {\n    // patch for clearInterval for compatible reason, see #1490\n    if (obj.hasOwnProperty(prop) || prop === 'clearInterval') {\n      callbackFn(prop);\n    }\n  }\n}\n/**\n * 基于 diff 方式实现的沙箱，用于不支持 Proxy 的低版本浏览器\n */\nvar SnapshotSandbox = /*#__PURE__*/function () {\n  function SnapshotSandbox(name) {\n    _classCallCheck(this, SnapshotSandbox);\n    this.proxy = void 0;\n    this.name = void 0;\n    this.type = void 0;\n    this.sandboxRunning = true;\n    this.windowSnapshot = void 0;\n    this.modifyPropsMap = {};\n    this.name = name;\n    this.proxy = window;\n    this.type = SandBoxType.Snapshot;\n  }\n  _createClass(SnapshotSandbox, [{\n    key: \"active\",\n    value: function active() {\n      var _this = this;\n      // 记录当前快照\n      this.windowSnapshot = {};\n      iter(window, function (prop) {\n        _this.windowSnapshot[prop] = window[prop];\n      });\n      // 恢复之前的变更\n      Object.keys(this.modifyPropsMap).forEach(function (p) {\n        window[p] = _this.modifyPropsMap[p];\n      });\n      this.sandboxRunning = true;\n    }\n  }, {\n    key: \"inactive\",\n    value: function inactive() {\n      var _this2 = this;\n      this.modifyPropsMap = {};\n      iter(window, function (prop) {\n        if (window[prop] !== _this2.windowSnapshot[prop]) {\n          // 记录变更，恢复环境\n          _this2.modifyPropsMap[prop] = window[prop];\n          window[prop] = _this2.windowSnapshot[prop];\n        }\n      });\n      if (process.env.NODE_ENV === 'development') {\n        console.info(\"[qiankun:sandbox] \".concat(this.name, \" origin window restore...\"), Object.keys(this.modifyPropsMap));\n      }\n      this.sandboxRunning = false;\n    }\n  }, {\n    key: \"patchDocument\",\n    value: function patchDocument() {}\n  }]);\n  return SnapshotSandbox;\n}();\nexport { SnapshotSandbox as default };","map":{"version":3,"names":["_classCallCheck","_createClass","SandBoxType","iter","obj","callbackFn","prop","hasOwnProperty","SnapshotSandbox","name","proxy","type","sandboxRunning","windowSnapshot","modifyPropsMap","window","Snapshot","key","value","active","_this","Object","keys","forEach","p","inactive","_this2","process","env","NODE_ENV","console","info","concat","patchDocument","default"],"sources":["/home/lishu/桌面/Micro_frontend_practice/qiankun_micro/qiankun-base/node_modules/qiankun/es/sandbox/snapshotSandbox.js"],"sourcesContent":["import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport { SandBoxType } from '../interfaces';\nfunction iter(obj, callbackFn) {\n  // eslint-disable-next-line guard-for-in, no-restricted-syntax\n  for (var prop in obj) {\n    // patch for clearInterval for compatible reason, see #1490\n    if (obj.hasOwnProperty(prop) || prop === 'clearInterval') {\n      callbackFn(prop);\n    }\n  }\n}\n/**\n * 基于 diff 方式实现的沙箱，用于不支持 Proxy 的低版本浏览器\n */\nvar SnapshotSandbox = /*#__PURE__*/function () {\n  function SnapshotSandbox(name) {\n    _classCallCheck(this, SnapshotSandbox);\n    this.proxy = void 0;\n    this.name = void 0;\n    this.type = void 0;\n    this.sandboxRunning = true;\n    this.windowSnapshot = void 0;\n    this.modifyPropsMap = {};\n    this.name = name;\n    this.proxy = window;\n    this.type = SandBoxType.Snapshot;\n  }\n  _createClass(SnapshotSandbox, [{\n    key: \"active\",\n    value: function active() {\n      var _this = this;\n      // 记录当前快照\n      this.windowSnapshot = {};\n      iter(window, function (prop) {\n        _this.windowSnapshot[prop] = window[prop];\n      });\n      // 恢复之前的变更\n      Object.keys(this.modifyPropsMap).forEach(function (p) {\n        window[p] = _this.modifyPropsMap[p];\n      });\n      this.sandboxRunning = true;\n    }\n  }, {\n    key: \"inactive\",\n    value: function inactive() {\n      var _this2 = this;\n      this.modifyPropsMap = {};\n      iter(window, function (prop) {\n        if (window[prop] !== _this2.windowSnapshot[prop]) {\n          // 记录变更，恢复环境\n          _this2.modifyPropsMap[prop] = window[prop];\n          window[prop] = _this2.windowSnapshot[prop];\n        }\n      });\n      if (process.env.NODE_ENV === 'development') {\n        console.info(\"[qiankun:sandbox] \".concat(this.name, \" origin window restore...\"), Object.keys(this.modifyPropsMap));\n      }\n      this.sandboxRunning = false;\n    }\n  }, {\n    key: \"patchDocument\",\n    value: function patchDocument() {}\n  }]);\n  return SnapshotSandbox;\n}();\nexport { SnapshotSandbox as default };"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}