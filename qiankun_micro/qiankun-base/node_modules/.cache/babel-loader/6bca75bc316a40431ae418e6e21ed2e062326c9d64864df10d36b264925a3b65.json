{"ast":null,"code":"import _isFunction from \"lodash/isFunction\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n/**\n * @author Kuitos\n * @since 2019-02-26\n */\nimport { importEntry } from 'import-html-entry';\nimport { getAppStatus, getMountedApps, NOT_LOADED } from 'single-spa';\nfunction idleCall(cb, start) {\n  cb({\n    didTimeout: false,\n    timeRemaining: function timeRemaining() {\n      return Math.max(0, 50 - (Date.now() - start));\n    }\n  });\n}\n// RIC and shim for browsers setTimeout() without it idle\nvar requestIdleCallback;\nif (typeof window.requestIdleCallback !== 'undefined') {\n  requestIdleCallback = window.requestIdleCallback;\n} else if (typeof window.MessageChannel !== 'undefined') {\n  // The first recommendation is to use MessageChannel because\n  // it does not have the 4ms delay of setTimeout\n  var channel = new MessageChannel();\n  var port = channel.port2;\n  var tasks = [];\n  channel.port1.onmessage = function (_ref) {\n    var data = _ref.data;\n    var task = tasks.shift();\n    if (!task) {\n      return;\n    }\n    idleCall(task, data.start);\n  };\n  requestIdleCallback = function requestIdleCallback(cb) {\n    tasks.push(cb);\n    port.postMessage({\n      start: Date.now()\n    });\n  };\n} else {\n  requestIdleCallback = function requestIdleCallback(cb) {\n    return setTimeout(idleCall, 0, cb, Date.now());\n  };\n}\nvar isSlowNetwork = navigator.connection ? navigator.connection.saveData || navigator.connection.type !== 'wifi' && navigator.connection.type !== 'ethernet' && /([23])g/.test(navigator.connection.effectiveType) : false;\n/**\n * prefetch assets, do nothing while in mobile network\n * @param entry\n * @param opts\n */\nfunction prefetch(entry, opts) {\n  if (!navigator.onLine || isSlowNetwork) {\n    // Don't prefetch if in a slow network or offline\n    return;\n  }\n  requestIdleCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var _yield$importEntry, getExternalScripts, getExternalStyleSheets;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return importEntry(entry, opts);\n        case 2:\n          _yield$importEntry = _context.sent;\n          getExternalScripts = _yield$importEntry.getExternalScripts;\n          getExternalStyleSheets = _yield$importEntry.getExternalStyleSheets;\n          requestIdleCallback(getExternalStyleSheets);\n          requestIdleCallback(getExternalScripts);\n        case 7:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  })));\n}\nfunction prefetchAfterFirstMounted(apps, opts) {\n  window.addEventListener('single-spa:first-mount', function listener() {\n    var notLoadedApps = apps.filter(function (app) {\n      return getAppStatus(app.name) === NOT_LOADED;\n    });\n    if (process.env.NODE_ENV === 'development') {\n      var mountedApps = getMountedApps();\n      console.log(\"[qiankun] prefetch starting after \".concat(mountedApps, \" mounted...\"), notLoadedApps);\n    }\n    notLoadedApps.forEach(function (_ref3) {\n      var entry = _ref3.entry;\n      return prefetch(entry, opts);\n    });\n    window.removeEventListener('single-spa:first-mount', listener);\n  });\n}\nexport function prefetchImmediately(apps, opts) {\n  if (process.env.NODE_ENV === 'development') {\n    console.log('[qiankun] prefetch starting for apps...', apps);\n  }\n  apps.forEach(function (_ref4) {\n    var entry = _ref4.entry;\n    return prefetch(entry, opts);\n  });\n}\nexport function doPrefetchStrategy(apps, prefetchStrategy, importEntryOpts) {\n  var appsName2Apps = function appsName2Apps(names) {\n    return apps.filter(function (app) {\n      return names.includes(app.name);\n    });\n  };\n  if (Array.isArray(prefetchStrategy)) {\n    prefetchAfterFirstMounted(appsName2Apps(prefetchStrategy), importEntryOpts);\n  } else if (_isFunction(prefetchStrategy)) {\n    _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var _yield$prefetchStrate, _yield$prefetchStrate2, criticalAppNames, _yield$prefetchStrate3, minorAppsName;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return prefetchStrategy(apps);\n          case 2:\n            _yield$prefetchStrate = _context2.sent;\n            _yield$prefetchStrate2 = _yield$prefetchStrate.criticalAppNames;\n            criticalAppNames = _yield$prefetchStrate2 === void 0 ? [] : _yield$prefetchStrate2;\n            _yield$prefetchStrate3 = _yield$prefetchStrate.minorAppsName;\n            minorAppsName = _yield$prefetchStrate3 === void 0 ? [] : _yield$prefetchStrate3;\n            prefetchImmediately(appsName2Apps(criticalAppNames), importEntryOpts);\n            prefetchAfterFirstMounted(appsName2Apps(minorAppsName), importEntryOpts);\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }, _callee2);\n    }))();\n  } else {\n    switch (prefetchStrategy) {\n      case true:\n        prefetchAfterFirstMounted(apps, importEntryOpts);\n        break;\n      case 'all':\n        prefetchImmediately(apps, importEntryOpts);\n        break;\n      default:\n        break;\n    }\n  }\n}","map":{"version":3,"names":["_isFunction","_asyncToGenerator","_regeneratorRuntime","importEntry","getAppStatus","getMountedApps","NOT_LOADED","idleCall","cb","start","didTimeout","timeRemaining","Math","max","Date","now","requestIdleCallback","window","MessageChannel","channel","port","port2","tasks","port1","onmessage","_ref","data","task","shift","push","postMessage","setTimeout","isSlowNetwork","navigator","connection","saveData","type","test","effectiveType","prefetch","entry","opts","onLine","mark","_callee","_yield$importEntry","getExternalScripts","getExternalStyleSheets","wrap","_callee$","_context","prev","next","sent","stop","prefetchAfterFirstMounted","apps","addEventListener","listener","notLoadedApps","filter","app","name","process","env","NODE_ENV","mountedApps","console","log","concat","forEach","_ref3","removeEventListener","prefetchImmediately","_ref4","doPrefetchStrategy","prefetchStrategy","importEntryOpts","appsName2Apps","names","includes","Array","isArray","_callee2","_yield$prefetchStrate","_yield$prefetchStrate2","criticalAppNames","_yield$prefetchStrate3","minorAppsName","_callee2$","_context2"],"sources":["/home/lishu/桌面/Micro_frontend_practice/qiankun_micro/qiankun-base/node_modules/qiankun/es/prefetch.js"],"sourcesContent":["import _isFunction from \"lodash/isFunction\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n/**\n * @author Kuitos\n * @since 2019-02-26\n */\nimport { importEntry } from 'import-html-entry';\nimport { getAppStatus, getMountedApps, NOT_LOADED } from 'single-spa';\nfunction idleCall(cb, start) {\n  cb({\n    didTimeout: false,\n    timeRemaining: function timeRemaining() {\n      return Math.max(0, 50 - (Date.now() - start));\n    }\n  });\n}\n// RIC and shim for browsers setTimeout() without it idle\nvar requestIdleCallback;\nif (typeof window.requestIdleCallback !== 'undefined') {\n  requestIdleCallback = window.requestIdleCallback;\n} else if (typeof window.MessageChannel !== 'undefined') {\n  // The first recommendation is to use MessageChannel because\n  // it does not have the 4ms delay of setTimeout\n  var channel = new MessageChannel();\n  var port = channel.port2;\n  var tasks = [];\n  channel.port1.onmessage = function (_ref) {\n    var data = _ref.data;\n    var task = tasks.shift();\n    if (!task) {\n      return;\n    }\n    idleCall(task, data.start);\n  };\n  requestIdleCallback = function requestIdleCallback(cb) {\n    tasks.push(cb);\n    port.postMessage({\n      start: Date.now()\n    });\n  };\n} else {\n  requestIdleCallback = function requestIdleCallback(cb) {\n    return setTimeout(idleCall, 0, cb, Date.now());\n  };\n}\nvar isSlowNetwork = navigator.connection ? navigator.connection.saveData || navigator.connection.type !== 'wifi' && navigator.connection.type !== 'ethernet' && /([23])g/.test(navigator.connection.effectiveType) : false;\n/**\n * prefetch assets, do nothing while in mobile network\n * @param entry\n * @param opts\n */\nfunction prefetch(entry, opts) {\n  if (!navigator.onLine || isSlowNetwork) {\n    // Don't prefetch if in a slow network or offline\n    return;\n  }\n  requestIdleCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var _yield$importEntry, getExternalScripts, getExternalStyleSheets;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return importEntry(entry, opts);\n        case 2:\n          _yield$importEntry = _context.sent;\n          getExternalScripts = _yield$importEntry.getExternalScripts;\n          getExternalStyleSheets = _yield$importEntry.getExternalStyleSheets;\n          requestIdleCallback(getExternalStyleSheets);\n          requestIdleCallback(getExternalScripts);\n        case 7:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  })));\n}\nfunction prefetchAfterFirstMounted(apps, opts) {\n  window.addEventListener('single-spa:first-mount', function listener() {\n    var notLoadedApps = apps.filter(function (app) {\n      return getAppStatus(app.name) === NOT_LOADED;\n    });\n    if (process.env.NODE_ENV === 'development') {\n      var mountedApps = getMountedApps();\n      console.log(\"[qiankun] prefetch starting after \".concat(mountedApps, \" mounted...\"), notLoadedApps);\n    }\n    notLoadedApps.forEach(function (_ref3) {\n      var entry = _ref3.entry;\n      return prefetch(entry, opts);\n    });\n    window.removeEventListener('single-spa:first-mount', listener);\n  });\n}\nexport function prefetchImmediately(apps, opts) {\n  if (process.env.NODE_ENV === 'development') {\n    console.log('[qiankun] prefetch starting for apps...', apps);\n  }\n  apps.forEach(function (_ref4) {\n    var entry = _ref4.entry;\n    return prefetch(entry, opts);\n  });\n}\nexport function doPrefetchStrategy(apps, prefetchStrategy, importEntryOpts) {\n  var appsName2Apps = function appsName2Apps(names) {\n    return apps.filter(function (app) {\n      return names.includes(app.name);\n    });\n  };\n  if (Array.isArray(prefetchStrategy)) {\n    prefetchAfterFirstMounted(appsName2Apps(prefetchStrategy), importEntryOpts);\n  } else if (_isFunction(prefetchStrategy)) {\n    _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var _yield$prefetchStrate, _yield$prefetchStrate2, criticalAppNames, _yield$prefetchStrate3, minorAppsName;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return prefetchStrategy(apps);\n          case 2:\n            _yield$prefetchStrate = _context2.sent;\n            _yield$prefetchStrate2 = _yield$prefetchStrate.criticalAppNames;\n            criticalAppNames = _yield$prefetchStrate2 === void 0 ? [] : _yield$prefetchStrate2;\n            _yield$prefetchStrate3 = _yield$prefetchStrate.minorAppsName;\n            minorAppsName = _yield$prefetchStrate3 === void 0 ? [] : _yield$prefetchStrate3;\n            prefetchImmediately(appsName2Apps(criticalAppNames), importEntryOpts);\n            prefetchAfterFirstMounted(appsName2Apps(minorAppsName), importEntryOpts);\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }, _callee2);\n    }))();\n  } else {\n    switch (prefetchStrategy) {\n      case true:\n        prefetchAfterFirstMounted(apps, importEntryOpts);\n        break;\n      case 'all':\n        prefetchImmediately(apps, importEntryOpts);\n        break;\n      default:\n        break;\n    }\n  }\n}"],"mappings":"AAAA,OAAOA,WAAW,MAAM,mBAAmB;AAC3C,OAAOC,iBAAiB,MAAM,6CAA6C;AAC3E,OAAOC,mBAAmB,MAAM,4BAA4B;AAC5D;AACA;AACA;AACA;AACA,SAASC,WAAW,QAAQ,mBAAmB;AAC/C,SAASC,YAAY,EAAEC,cAAc,EAAEC,UAAU,QAAQ,YAAY;AACrE,SAASC,QAAQA,CAACC,EAAE,EAAEC,KAAK,EAAE;EAC3BD,EAAE,CAAC;IACDE,UAAU,EAAE,KAAK;IACjBC,aAAa,EAAE,SAASA,aAAaA,CAAA,EAAG;MACtC,OAAOC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE,EAAE,IAAIC,IAAI,CAACC,GAAG,CAAC,CAAC,GAAGN,KAAK,CAAC,CAAC;IAC/C;EACF,CAAC,CAAC;AACJ;AACA;AACA,IAAIO,mBAAmB;AACvB,IAAI,OAAOC,MAAM,CAACD,mBAAmB,KAAK,WAAW,EAAE;EACrDA,mBAAmB,GAAGC,MAAM,CAACD,mBAAmB;AAClD,CAAC,MAAM,IAAI,OAAOC,MAAM,CAACC,cAAc,KAAK,WAAW,EAAE;EACvD;EACA;EACA,IAAIC,OAAO,GAAG,IAAID,cAAc,CAAC,CAAC;EAClC,IAAIE,IAAI,GAAGD,OAAO,CAACE,KAAK;EACxB,IAAIC,KAAK,GAAG,EAAE;EACdH,OAAO,CAACI,KAAK,CAACC,SAAS,GAAG,UAAUC,IAAI,EAAE;IACxC,IAAIC,IAAI,GAAGD,IAAI,CAACC,IAAI;IACpB,IAAIC,IAAI,GAAGL,KAAK,CAACM,KAAK,CAAC,CAAC;IACxB,IAAI,CAACD,IAAI,EAAE;MACT;IACF;IACApB,QAAQ,CAACoB,IAAI,EAAED,IAAI,CAACjB,KAAK,CAAC;EAC5B,CAAC;EACDO,mBAAmB,GAAG,SAASA,mBAAmBA,CAACR,EAAE,EAAE;IACrDc,KAAK,CAACO,IAAI,CAACrB,EAAE,CAAC;IACdY,IAAI,CAACU,WAAW,CAAC;MACfrB,KAAK,EAAEK,IAAI,CAACC,GAAG,CAAC;IAClB,CAAC,CAAC;EACJ,CAAC;AACH,CAAC,MAAM;EACLC,mBAAmB,GAAG,SAASA,mBAAmBA,CAACR,EAAE,EAAE;IACrD,OAAOuB,UAAU,CAACxB,QAAQ,EAAE,CAAC,EAAEC,EAAE,EAAEM,IAAI,CAACC,GAAG,CAAC,CAAC,CAAC;EAChD,CAAC;AACH;AACA,IAAIiB,aAAa,GAAGC,SAAS,CAACC,UAAU,GAAGD,SAAS,CAACC,UAAU,CAACC,QAAQ,IAAIF,SAAS,CAACC,UAAU,CAACE,IAAI,KAAK,MAAM,IAAIH,SAAS,CAACC,UAAU,CAACE,IAAI,KAAK,UAAU,IAAI,SAAS,CAACC,IAAI,CAACJ,SAAS,CAACC,UAAU,CAACI,aAAa,CAAC,GAAG,KAAK;AAC1N;AACA;AACA;AACA;AACA;AACA,SAASC,QAAQA,CAACC,KAAK,EAAEC,IAAI,EAAE;EAC7B,IAAI,CAACR,SAAS,CAACS,MAAM,IAAIV,aAAa,EAAE;IACtC;IACA;EACF;EACAhB,mBAAmB,EAAE,aAAaf,iBAAiB,EAAE,aAAaC,mBAAmB,CAACyC,IAAI,CAAC,SAASC,OAAOA,CAAA,EAAG;IAC5G,IAAIC,kBAAkB,EAAEC,kBAAkB,EAAEC,sBAAsB;IAClE,OAAO7C,mBAAmB,CAAC8C,IAAI,CAAC,SAASC,QAAQA,CAACC,QAAQ,EAAE;MAC1D,OAAO,CAAC,EAAE,QAAQA,QAAQ,CAACC,IAAI,GAAGD,QAAQ,CAACE,IAAI;QAC7C,KAAK,CAAC;UACJF,QAAQ,CAACE,IAAI,GAAG,CAAC;UACjB,OAAOjD,WAAW,CAACqC,KAAK,EAAEC,IAAI,CAAC;QACjC,KAAK,CAAC;UACJI,kBAAkB,GAAGK,QAAQ,CAACG,IAAI;UAClCP,kBAAkB,GAAGD,kBAAkB,CAACC,kBAAkB;UAC1DC,sBAAsB,GAAGF,kBAAkB,CAACE,sBAAsB;UAClE/B,mBAAmB,CAAC+B,sBAAsB,CAAC;UAC3C/B,mBAAmB,CAAC8B,kBAAkB,CAAC;QACzC,KAAK,CAAC;QACN,KAAK,KAAK;UACR,OAAOI,QAAQ,CAACI,IAAI,CAAC,CAAC;MAC1B;IACF,CAAC,EAAEV,OAAO,CAAC;EACb,CAAC,CAAC,CAAC,CAAC;AACN;AACA,SAASW,yBAAyBA,CAACC,IAAI,EAAEf,IAAI,EAAE;EAC7CxB,MAAM,CAACwC,gBAAgB,CAAC,wBAAwB,EAAE,SAASC,QAAQA,CAAA,EAAG;IACpE,IAAIC,aAAa,GAAGH,IAAI,CAACI,MAAM,CAAC,UAAUC,GAAG,EAAE;MAC7C,OAAOzD,YAAY,CAACyD,GAAG,CAACC,IAAI,CAAC,KAAKxD,UAAU;IAC9C,CAAC,CAAC;IACF,IAAIyD,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa,EAAE;MAC1C,IAAIC,WAAW,GAAG7D,cAAc,CAAC,CAAC;MAClC8D,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAACC,MAAM,CAACH,WAAW,EAAE,aAAa,CAAC,EAAEP,aAAa,CAAC;IACrG;IACAA,aAAa,CAACW,OAAO,CAAC,UAAUC,KAAK,EAAE;MACrC,IAAI/B,KAAK,GAAG+B,KAAK,CAAC/B,KAAK;MACvB,OAAOD,QAAQ,CAACC,KAAK,EAAEC,IAAI,CAAC;IAC9B,CAAC,CAAC;IACFxB,MAAM,CAACuD,mBAAmB,CAAC,wBAAwB,EAAEd,QAAQ,CAAC;EAChE,CAAC,CAAC;AACJ;AACA,OAAO,SAASe,mBAAmBA,CAACjB,IAAI,EAAEf,IAAI,EAAE;EAC9C,IAAIsB,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa,EAAE;IAC1CE,OAAO,CAACC,GAAG,CAAC,yCAAyC,EAAEZ,IAAI,CAAC;EAC9D;EACAA,IAAI,CAACc,OAAO,CAAC,UAAUI,KAAK,EAAE;IAC5B,IAAIlC,KAAK,GAAGkC,KAAK,CAAClC,KAAK;IACvB,OAAOD,QAAQ,CAACC,KAAK,EAAEC,IAAI,CAAC;EAC9B,CAAC,CAAC;AACJ;AACA,OAAO,SAASkC,kBAAkBA,CAACnB,IAAI,EAAEoB,gBAAgB,EAAEC,eAAe,EAAE;EAC1E,IAAIC,aAAa,GAAG,SAASA,aAAaA,CAACC,KAAK,EAAE;IAChD,OAAOvB,IAAI,CAACI,MAAM,CAAC,UAAUC,GAAG,EAAE;MAChC,OAAOkB,KAAK,CAACC,QAAQ,CAACnB,GAAG,CAACC,IAAI,CAAC;IACjC,CAAC,CAAC;EACJ,CAAC;EACD,IAAImB,KAAK,CAACC,OAAO,CAACN,gBAAgB,CAAC,EAAE;IACnCrB,yBAAyB,CAACuB,aAAa,CAACF,gBAAgB,CAAC,EAAEC,eAAe,CAAC;EAC7E,CAAC,MAAM,IAAI7E,WAAW,CAAC4E,gBAAgB,CAAC,EAAE;IACxC3E,iBAAiB,EAAE,aAAaC,mBAAmB,CAACyC,IAAI,CAAC,SAASwC,QAAQA,CAAA,EAAG;MAC3E,IAAIC,qBAAqB,EAAEC,sBAAsB,EAAEC,gBAAgB,EAAEC,sBAAsB,EAAEC,aAAa;MAC1G,OAAOtF,mBAAmB,CAAC8C,IAAI,CAAC,SAASyC,SAASA,CAACC,SAAS,EAAE;QAC5D,OAAO,CAAC,EAAE,QAAQA,SAAS,CAACvC,IAAI,GAAGuC,SAAS,CAACtC,IAAI;UAC/C,KAAK,CAAC;YACJsC,SAAS,CAACtC,IAAI,GAAG,CAAC;YAClB,OAAOwB,gBAAgB,CAACpB,IAAI,CAAC;UAC/B,KAAK,CAAC;YACJ4B,qBAAqB,GAAGM,SAAS,CAACrC,IAAI;YACtCgC,sBAAsB,GAAGD,qBAAqB,CAACE,gBAAgB;YAC/DA,gBAAgB,GAAGD,sBAAsB,KAAK,KAAK,CAAC,GAAG,EAAE,GAAGA,sBAAsB;YAClFE,sBAAsB,GAAGH,qBAAqB,CAACI,aAAa;YAC5DA,aAAa,GAAGD,sBAAsB,KAAK,KAAK,CAAC,GAAG,EAAE,GAAGA,sBAAsB;YAC/Ed,mBAAmB,CAACK,aAAa,CAACQ,gBAAgB,CAAC,EAAET,eAAe,CAAC;YACrEtB,yBAAyB,CAACuB,aAAa,CAACU,aAAa,CAAC,EAAEX,eAAe,CAAC;UAC1E,KAAK,CAAC;UACN,KAAK,KAAK;YACR,OAAOa,SAAS,CAACpC,IAAI,CAAC,CAAC;QAC3B;MACF,CAAC,EAAE6B,QAAQ,CAAC;IACd,CAAC,CAAC,CAAC,CAAC,CAAC;EACP,CAAC,MAAM;IACL,QAAQP,gBAAgB;MACtB,KAAK,IAAI;QACPrB,yBAAyB,CAACC,IAAI,EAAEqB,eAAe,CAAC;QAChD;MACF,KAAK,KAAK;QACRJ,mBAAmB,CAACjB,IAAI,EAAEqB,eAAe,CAAC;QAC1C;MACF;QACE;IACJ;EACF;AACF"},"metadata":{},"sourceType":"module","externalDependencies":[]}