# å¼•è¨€

éšç€å‰ç«¯åº”ç”¨è§„æ¨¡çš„ä¸æ–­å¢é•¿ï¼Œä¼ ç»Ÿçš„å•ä½“åº”ç”¨æ¶æ„å˜å¾—éš¾ä»¥ç»´æŠ¤ã€‚å¾®å‰ç«¯ä½œä¸ºä¸€ç§æ¶æ„æ¨¡å¼ï¼Œæ—¨åœ¨è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå°†å‰ç«¯åº”ç”¨æ‹†åˆ†ä¸ºæ›´å°ã€æ›´å¯ç®¡ç†çš„éƒ¨åˆ†ã€‚æœ¬æ–‡å°†æ¢è®¨å¾®å‰ç«¯çš„æ¦‚å¿µã€ä¼˜åŠ¿ã€å®ç°æ–¹å¼ä»¥åŠä¸€äº›æœ€ä½³å®è·µ

# ç®€ä»‹

## ä»€ä¹ˆæ˜¯å¾®å‰ç«¯

å¾®å‰ç«¯æ˜¯æŒ‡å­˜åœ¨äºæµè§ˆå™¨ä¸­çš„å¾®æœåŠ¡ï¼Œå…¶å€Ÿé‰´äº†å¾®æœåŠ¡çš„æ„æ¶ç†å¿µï¼Œå°†å¾®æœåŠ¡çš„æ¦‚å¿µæ‰©å±•åˆ°äº†å‰ç«¯ã€‚å³å¾®å‰ç«¯å°±æ˜¯å°†ä¸€ä¸ªå¤§å‹çš„å‰ç«¯åº”ç”¨æ‹†åˆ†æˆå¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªå¾®å‰ç«¯æ¨¡å—å¯ä»¥ç”±ä¸åŒçš„å›¢é˜Ÿè¿›è¡Œç®¡ç†ï¼Œå¹¶å¯ä»¥è‡ªä¸»é€‰æ‹©æ¡†æ¶ï¼Œä¸”æ‹¥æœ‰è‡ªå·±çš„ä»“åº“ï¼Œå¯ä»¥ç‹¬ç«‹éƒ¨ç½²ä¸Šçº¿ã€‚

![æœªå‘½åæ–‡ä»¶.jpg](https://gitee.com/yelishu/note/raw/master/noteImgs_2/202311301350860.jpg)

## ä¸ºä»€ä¹ˆä½¿ç”¨å¾®å‰ç«¯

- å·¥ç¨‹è§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œæ‰“åŒ…è¶Šæ¥è¶Šæ…¢
- å›¢é˜Ÿæˆå‘˜å¤šï¼ŒåŠŸèƒ½å¤æ‚ï¼Œä»£ç å†²çªé¢‘ç¹ï¼Œå½±å“é¢ç§¯å¤§ï¼Œéš¾ä»¥ç»´æŠ¤

ä¸€èˆ¬å¾®å‰ç«¯å¤šåº”ç”¨äºä¼ä¸šä¸­çš„ä¸­åå°é¡¹ç›®ï¼Œå› ä¸ºä¼ä¸šå†…éƒ¨çš„ä¸­åå°é¡¹ç›®å­˜æ´»æ—¶é—´è¾ƒé•¿ï¼Œæ˜“æ¼”å˜æˆä¸€ä¸ªå·¨çŸ³åº”ç”¨ï¼Œå¼•èµ·**æŠ€æœ¯æ ˆè½åã€ç¼–è¯‘éƒ¨ç½²æ…¢**ç­‰é—®é¢˜ã€‚

**ä¸¾ä¸ªğŸŒ°**
ä¾‹å¦‚ï¼šä¸€ä¸ªç”µå•†å¹³å°çš„åå°ç®¡ç†ç³»ç»Ÿç”±å‡ ä¸ªæ¨¡å—æ„æˆï¼ŒåŒ…æ‹¬å•†å“ç®¡ç†ã€åº“å­˜ç®¡ç†ã€ç‰©æµç®¡ç†ç­‰æ¨¡å—ã€‚ç›®å‰éœ€è¦åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ è®¢å•ç®¡ç†ã€é…é€ç³»ç»Ÿç­‰ã€‚

- ä¹‹å‰çš„é¡¹ç›®æ¶æ„

![æœªå‘½åæ–‡ä»¶.jpg](https://gitee.com/yelishu/note/raw/master/noteImgs_2/202311301350334.jpg)

- å¼•å…¥å¾®å‰ç«¯å

![æœªå‘½åæ–‡ä»¶ (2).jpg](https://gitee.com/yelishu/note/raw/master/noteImgs_2/202311301406234.jpg)

## å¾®å‰ç«¯çš„ä¼˜åŠ¿

### å›¢é˜Ÿè‡ªæ²»

åœ¨å…¬å¸ä¸­ï¼Œé€šå¸¸å›¢é˜ŸæŒ‰ç…§ä¸šåŠ¡è¿›è¡Œåˆ’åˆ†ã€‚åœ¨æ²¡æœ‰å¾®å‰ç«¯çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå‡ ä¸ªå›¢é˜Ÿå…±åŒç»´æŠ¤ä¸€ä¸ªé¡¹ç›®ï¼Œå¾ˆå¯èƒ½ä¼šé¢ä¸´ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ä»£ç åˆå¹¶å†²çªã€ä¸Šçº¿æ—¶é—´å†²çªç­‰ã€‚å¼•å…¥å¾®å‰ç«¯åï¼Œå¯ä»¥å°†é¡¹ç›®æŒ‰ç…§ä¸šåŠ¡æ¨¡å—æ‹†åˆ†æˆè¾ƒå°çš„æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—ç”±ä¸åŒçš„å›¢é˜Ÿè´Ÿè´£ç»´æŠ¤ï¼Œå®ç°<span style="color:#ff0000">ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²ä¸Šçº¿</span>ã€‚è¿™æ ·ä¸€æ¥ï¼Œå›¢é˜Ÿèƒ½å¤Ÿå®ç°è‡ªæ²»ï¼Œæ˜¾è‘—å‡å°‘ç”šè‡³æ¶ˆé™¤ä¸å…¶ä»–å›¢é˜Ÿå‘ç”Ÿå†²çªçš„å¯èƒ½æ€§ã€‚

![æœªå‘½åæ–‡ä»¶.jpg](https://gitee.com/yelishu/note/raw/master/noteImgs_2/202311301502615.jpg)

### å…¼å®¹è€é¡¹ç›®

- è‹¥å…¬å¸ä¸­å­˜åœ¨`JQuery`æˆ–è€…å…¶ä»–å·¨çŸ³é¡¹ç›®ï¼Œä½†åˆä¸æƒ³ç”¨æ—§çš„æŠ€æœ¯æ ˆå»ç»´æŠ¤ï¼Œé€‰æ‹©ä½¿ç”¨å¾®å‰ç«¯çš„æ–¹å¼å»æ‹†åˆ†é¡¹ç›®æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚
- å¦ä¸€æ–¹é¢ï¼Œå½“æŠ€æœ¯å€ºé˜»ç¢äº†é¡¹ç›®çš„å‘å±•ï¼Œåªèƒ½é‡å†™æ—¶ï¼Œä¸ºäº†é¿å…å®Œå…¨é‡å†™çš„é£é™©ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›é€ä¸ªæ›¿æ¢æ—§çš„æ¨¡å—ï¼Œè¿™ä¹Ÿæ˜¯å¤§å¤šæ•°å›¢é˜Ÿé‡‡ç”¨å¾®å‰ç«¯çš„é¦–è¦åŸå› ã€‚

### ç®€å•ã€è§£è€¦çš„ä»£ç åº“

- å¯¹äºä¸Šä¾‹ï¼Œè‹¥å¾®å‰ç«¯ç³»ç»Ÿä¸­éœ€è¦æ–°å¢ä¸€ä¸ªä¸šåŠ¡æ¨¡å—æ—¶ï¼Œåªéœ€è¦å•ç‹¬çš„æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œè‡³äºé¡¹ç›®é‡‡ç”¨ä»€ä¹ˆæŠ€æœ¯æ ˆï¼Œå®Œå…¨ç”±å›¢é˜Ÿè‡ªä¸»å†³å®šï¼Œå³ä½¿å’Œå…¶ä»–æ¨¡å—é‡‡ç”¨ä¸åŒæŠ€æœ¯æ ˆä¹Ÿä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ã€‚
- æ¯ä¸ªç‹¬ç«‹çš„å¾®å‰ç«¯åº”ç”¨æºä»£ç é€šå¸¸æ¯”å•ä¸ªæ•´ä½“å‰ç«¯ä»£ç æ›´ä¸ºç²¾ç®€ã€‚è¿™æ ·çš„å°å‹ä»£ç åº“å¯¹å¼€å‘äººå‘˜è€Œè¨€æ›´åŠ ç®€ä¾¿ã€æ˜“äºä½¿ç”¨ã€‚æœ€å…³é”®çš„æ˜¯ï¼Œè¿™æœ‰åŠ©äºé¿å…ç”±äºç»„ä»¶ä¹‹é—´ä¸åº”è¯¥ç›¸äº’äº†è§£è€Œå¯¼è‡´çš„æ— æ„å’Œä¸é€‚å½“çš„è€¦åˆï¼Œä»è€Œå‡å°‘å¤æ‚æ€§ã€‚

### ç‹¬ç«‹éƒ¨ç½²

ä¸å¾®æœåŠ¡ç±»ä¼¼ï¼Œå¾®å‰ç«¯çš„ç‹¬ç«‹å¯éƒ¨ç½²æ€§è‡³å…³é‡è¦ã€‚è¿™æœ‰åŠ©äºç¼©å°æ¯ä¸ªéƒ¨ç½²çš„èŒƒå›´ï¼Œä»è€Œå‡å°‘ç›¸å…³é£é™©ã€‚æ— è®ºå‰ç«¯ä»£ç åœ¨ä½•å¤„æ‰˜ç®¡ï¼Œæ¯ä¸ªå¾®å‰ç«¯éƒ½åº”å…·å¤‡è‡ªå·±çš„æŒç»­äº¤ä»˜ç®¡é“ï¼Œç”¨äºæ„å»ºã€æµ‹è¯•å’Œå°†å‰ç«¯ä»£ç éƒ¨ç½²è‡³ç”Ÿäº§ç¯å¢ƒã€‚è¿™æ ·çš„ç‹¬ç«‹æ€§ç¡®ä¿äº†æ¯ä¸ªå¾®å‰ç«¯éƒ½èƒ½å¤Ÿç‹¬ç«‹è¿›è¡Œæ›´æ–°å’Œå‘å¸ƒï¼Œä¸å—å…¶ä»–éƒ¨åˆ†çš„å½±å“ã€‚

![æœªå‘½åæ–‡ä»¶ (1).jpg](https://gitee.com/yelishu/note/raw/master/noteImgs_2/202311301608304.jpg)

### æ€»ç»“

![æœªå‘½åæ–‡ä»¶ (3).jpg](https://gitee.com/yelishu/note/raw/master/noteImgs_2/202311301634606.jpg)

ç®€è€Œè¨€ä¹‹ï¼Œå¾®å‰ç«¯çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†åºå¤§è€Œåºæ‚çš„ç³»ç»Ÿåˆ†å‰²æˆæ›´å°ã€æ›´æ˜“ç®¡ç†çš„éƒ¨åˆ†ï¼Œå¹¶æ¸…æ™°å®šä¹‰å®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚æˆ‘ä»¬çš„æŠ€æœ¯é€‰æ‹©ã€ä»£ç åº“ã€å›¢é˜Ÿä»¥åŠå‘å¸ƒæµç¨‹éƒ½åº”è¯¥èƒ½å¤Ÿç‹¬ç«‹è¿ä½œå’Œå‘å±•ï¼Œæ— éœ€è¿‡åº¦åè°ƒã€‚è¿™ç§ç‹¬ç«‹æ€§æœ‰åŠ©äºæé«˜å¼€å‘æ•ˆç‡ï¼Œé™ä½ç³»ç»Ÿç»´æŠ¤çš„å¤æ‚æ€§ã€‚

# ç°æœ‰çš„å¾®å‰ç«¯æ–¹æ¡ˆ

## iframe

ä½¿ç”¨`iframe`æ ‡ç­¾å°†æ¯ä¸ªå­åº”ç”¨åµŒå…¥åˆ°çˆ¶åº”ç”¨ä¸­ï¼Œ`iframe`å¤©ç„¶å…·å¤‡éš”ç¦»å±æ€§ï¼Œç¡®ä¿å„ä¸ªå­åº”ç”¨ç›¸äº’ç‹¬ç«‹ï¼ŒåŒæ—¶ä¹Ÿä¸çˆ¶åº”ç”¨éš”ç¦»ã€‚

ç„¶è€Œï¼Œ`iframe`å­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼š
- `URL`ä¸åŒæ­¥ï¼šåˆ·æ–°é¡µé¢æ—¶ï¼Œ`iframe`ä¸­é¡µé¢çš„è·¯ç”±ä¿¡æ¯ä¼šä¸¢å¤±ã€‚
- å…¨å±€ä¸Šä¸‹æ–‡å®Œå…¨éš”ç¦»ï¼šå†…å­˜å˜é‡ä¸å…±äº«ï¼Œå¯¼è‡´å„å­åº”ç”¨ä¹‹é—´ä¿¡æ¯æ— æ³•ç›´æ¥äº¤äº’ã€‚
- `UI`ä¸åŒæ­¥ï¼šä¾‹å¦‚ï¼Œå¦‚æœ`iframe`ä¸­çš„é¡µé¢åŒ…å«å¸¦é®ç½©å±‚çš„ç»„ä»¶å¼¹çª—ï¼Œé®ç½©æ— æ³•å…¨å±€è¦†ç›–æ•´ä¸ªæµè§ˆå™¨ï¼Œä»…åœ¨`iframe`å†…ç”Ÿæ•ˆã€‚
- æ€§èƒ½è¾ƒæ…¢ï¼šæ¯æ¬¡å­åº”ç”¨è¿›å…¥éƒ½éœ€è¦è¿›è¡Œæµè§ˆå™¨ä¸Šä¸‹æ–‡çš„é‡å»ºå’Œèµ„æºé‡æ–°åŠ è½½ï¼Œå½±å“åŠ è½½é€Ÿåº¦ã€‚
  

**ä¸¾ä¸ªğŸŒ°**

```html
<!-- index.html -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸»åº”ç”¨</title>
</head>

<body>
    <h1>ä¸»åº”ç”¨</h1>
    <iframe src="app1.html#page1" width="400" height="300" frameborder="1"></iframe>
    <iframe src="app2.html#page2" width="400" height="300" frameborder="1"></iframe>
    <script>
        // æ¨¡æ‹Ÿä¸»åº”ç”¨ä¸­çš„å…¨å±€å˜é‡
        window.sharedVariableMainApp = "Shared Value from Main App";
    </script>
</body>

</html>
```

```html
<!-- app1.html -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App 1</title>
    <style>
        #modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 20px;
            display: none;
        }
    </style>
</head>

<body>
    <h2>App 1 å†…å®¹</h2>
    <p>å½“å‰é¡µé¢: <span id="currentPage"></span></p>
    <p>æ¥è‡ªä¸»é¡µé¢çš„å…±äº«å˜é‡ï¼š <span id="sharedVariableMainVal"></span></p>

    <!-- æ¨¡æ‹ŸApp1ä¸­çš„å…±äº«å˜é‡ -->
    <script>
        // éœ€è¦é€šè¿‡çˆ¶æ¥è¿›è¡Œæ•°æ®å…±äº«
        // window.parent.sharedVariableApp1 = "åº”ç”¨ç¨‹åº1çš„å…±äº«å†…å®¹";

        // å­åº”ç”¨ä¹‹é—´å…¨å±€ä¸Šä¸‹æ–‡å®Œå…¨éš”ç¦»
        window.sharedVariableApp1 = "åº”ç”¨ç¨‹åº1çš„å…±äº«å†…å®¹";
    </script>

    <!-- åœ¨App1ä¸­ä½¿ç”¨é®ç›–æ¨¡æ‹Ÿæ¨¡æ€ -->
    <div id="modal">
        è¿™æ˜¯App1ä¸­çš„ä¸€ä¸ªæ¨¡æ€
    </div>

    <button onclick="toggleModal()">åˆ‡æ¢æ¨¡æ€</button>

    <script>
        function toggleModal() {
            const modal = document.getElementById('modal');
            modal.style.display = (modal.style.display === 'none' || modal.style.display === '') ? 'block' : 'none';
        }

        // æ ¹æ®URLæ˜¾ç¤ºå½“å‰é¡µé¢
        document.getElementById('currentPage').innerText = window.location.hash;

        // è·å–ä¸»é¡µé¢å…±äº«æ•°æ®
        // çˆ¶å­åº”ç”¨ä¹‹é—´å…¨å±€ä¸Šä¸‹æ–‡å®Œå…¨éš”ç¦»
        document.getElementById('sharedVariableMainVal').innerText = window.sharedVariableMainApp || "ä¸å¯ç”¨";

        // éœ€è¦é€šè¿‡window.parentè·å–
        // document.getElementById('sharedVariableMainVal').innerText = window.parent.sharedVariableMainApp || "ä¸å¯ç”¨";
    </script>
</body>

</html>
```

```html
<!-- app2.html -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App 2</title>
    <style>
        #modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(255, 0, 0, 0.5);
            color: white;
            padding: 20px;
            display: none;
        }
    </style>
</head>

<body>
    <h2>App 2 å†…å®¹</h2>
    <p>æ¥è‡ªApp1çš„å…±äº«å˜é‡ï¼š <span id="sharedVariableApp1Val"></span></p>
    <p>æ¥è‡ªä¸»é¡µé¢çš„å…±äº«å˜é‡ï¼š <span id="sharedVariableMainVal"></span></p>

    <!-- å°è¯•åœ¨App2ä¸­ä½¿ç”¨æ¨¡æ€è¦†ç›–æ•´ä¸ªæµè§ˆå™¨ -->
    <div id="modal">
        è¿™æ˜¯App2ä¸­è¯•å›¾è¦†ç›–æ•´ä¸ªæµè§ˆå™¨çš„æ¨¡å¼
    </div>

    <button onclick="toggleModal()">åˆ‡æ¢æ¨¡æ€</button>

    <script>
        function toggleModal() {
            const modal = document.getElementById('modal');
            modal.style.display = (modal.style.display === 'none' || modal.style.display === '') ? 'block' : 'none';
        }

        // æ˜¾ç¤ºApp1ä¸­çš„å…±äº«å˜é‡
        // å­åº”ç”¨ä¹‹é—´å…¨å±€ä¸Šä¸‹æ–‡å®Œå…¨éš”ç¦»
        document.getElementById('sharedVariableApp1Val').innerText = window.sharedVariableApp1 || "ä¸å¯ç”¨";

        // éœ€è¦å€ŸåŠ©çˆ¶æ¥è·å–App1ä¸­çš„å…±äº«å˜é‡
        // document.getElementById('sharedVariableApp1').innerText = window.parent.sharedVariableApp1 || "ä¸å¯ç”¨";


        // è·å–ä¸»é¡µé¢å…±äº«æ•°æ®
        // çˆ¶å­åº”ç”¨ä¹‹é—´å…¨å±€ä¸Šä¸‹æ–‡å®Œå…¨éš”ç¦»
        document.getElementById('sharedVariableMainVal').innerText = window.sharedVariableMainApp || "ä¸å¯ç”¨";

        // éœ€è¦é€šè¿‡window.parentè·å–
        // document.getElementById('sharedVariableMainVal').innerText = window.parent.sharedVariableMainApp || "ä¸å¯ç”¨";

    </script>
</body>

</html>
```

ä¸Šä¾‹ä¸­ï¼Œç”±äº`UI`ä¸åŒæ­¥ï¼Œåœ¨`App1`å’Œ`App2`ä¸­ç‚¹å‡»åˆ‡æ¢æ¨¡æ€æ—¶ï¼Œå¯¹åº”çš„é®ç½©æ ·å¼æ— æ³•å…¨å±€è¦†ç›–æ•´ä¸ªæµè§ˆå™¨ï¼Œä»…åœ¨ç›¸åº”çš„`iframe`å†…ç”Ÿæ•ˆã€‚ç”±äºå…¨å±€ä¸Šä¸‹æ–‡å®Œå…¨éš”ç¦»ï¼Œåœ¨`App2`ä¸­æ— æ³•ç›´æ¥é€šè¿‡`window.sharedVariableApp1`æ‹¿åˆ°App1ä¸­å…±äº«çš„å˜é‡ï¼›åŒç†ï¼Œåœ¨`App1`å’Œ`App2`ä¸­ä¹Ÿæ— æ³•ç›´æ¥é€šè¿‡`window.sharedVariableMainApp`æ‹¿åˆ°ä¸»åº”ç”¨å…±äº«çš„å˜é‡ã€‚

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iframe_micro</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        html,
        body {
            width: 100%;
            height: 100%;
        }

        #main_app {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="main_app">
        <h1>This is iframe_micro demo!</h1>

        <iframe frameborder="0" id="micro-frontend-container" width="100%" height="100%"></iframe>
    </div>

    <script>
        // ç¡®ä¿é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function () {
            updateIframeSrc();
        });

        // ç›‘å¬URLå“ˆå¸Œå˜åŒ–
        window.addEventListener('hashchange', function () {
            updateIframeSrc()
        })

        // æ›´æ–°iframeçš„src
        function updateIframeSrc() {
            const iframe = document.getElementById('micro-frontend-container');
            const hash = window.location.hash;
            iframe.src = microFrontendsByRoute[hash];
        }

        // å®šä¹‰ä¸åŒè·¯ç”±å¯¹åº”çš„å¾®å‰ç«¯URL
        const microFrontendsByRoute = {
            '': 'https://dewu.com',
            '#h5': 'https://h5.dewu.com',
            '#shihuo': 'https://www.shihuo.cn'
        }
    </script>
</body>

</html>
```

## Single-spa

å®˜ç½‘ï¼š[https://zh-hans.single-spa.js.org/docs/getting-started-overview](https://zh-hans.single-spa.js.org/docs/getting-started-overview)

`Single-spa`æ˜¯æœ€æ—©å¼•å…¥å¾®å‰ç«¯æ¦‚å¿µçš„æ¡†æ¶ä¹‹ä¸€ï¼Œå…·å¤‡å¯¹å¤šç§æŠ€æœ¯æ ˆçš„å…¼å®¹æ€§ã€‚

åœ¨`Single-spa`ä¸­ï¼Œé¦–å…ˆåœ¨åŸºåº§ä¸­æ³¨å†Œæ‰€æœ‰å­åº”ç”¨çš„è·¯ç”±ã€‚å½“URLå‘ç”Ÿå˜åŒ–æ—¶ï¼Œ`Single-spa`ä¼šè¿›è¡ŒåŒ¹é…ï¼ŒåŠ è½½å¯¹åº”çš„å­åº”ç”¨ã€‚ç›¸è¾ƒäºiframeå®ç°æ–¹æ¡ˆï¼Œ`Single-spa`é€šè¿‡åœ¨åŸºåº§å’Œå„ä¸ªå­åº”ç”¨ä¹‹é—´å…±äº«ä¸€ä¸ªå…¨å±€ä¸Šä¸‹æ–‡ï¼Œè§£å†³äº†`URL`ä¸åŒæ­¥å’Œ`UI`ä¸åŒæ­¥çš„é—®é¢˜ã€‚

ç„¶è€Œï¼Œ`Single-spa`ä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼š
- **ç¼ºä¹JSå’ŒCSSéš”ç¦»ï¼š** æ²¡æœ‰æä¾›è¶³å¤Ÿå¼ºå¤§çš„éš”ç¦»æœºåˆ¶ï¼Œå¯èƒ½å¯¼è‡´å­åº”ç”¨é—´çš„å‘½åå†²çªå’Œæ ·å¼è¦†ç›–ç­‰é—®é¢˜ã€‚
- **é…ç½®ç¹çï¼š** éœ€è¦ä¿®æ”¹å¤§é‡é…ç½®ï¼ŒåŒ…æ‹¬åŸºåº§å’Œå­åº”ç”¨çš„é…ç½®ï¼Œä¸èƒ½ç›´æ¥å¼€ç®±å³ç”¨ã€‚

## qiankun

[qiankun](https://qiankun.umijs.org/zh)æ˜¯ç”±é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€æ¬¾å¾®å‰ç«¯æ¡†æ¶ï¼Œå®ƒæ—¨åœ¨è§£å†³å¤šä¸ªç‹¬ç«‹å‰ç«¯åº”ç”¨é›†æˆå¼€å‘ã€æ„å»ºå’Œéƒ¨ç½²çš„é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯`qiankun`çš„ä¸€äº›ä¸»è¦ä¼˜åŠ¿ï¼š
- **åŸºäº Single-spa å°è£…ï¼š** `qiankun`åŸºäº`Single-spa`è¿›è¡Œäº†äºŒæ¬¡å°è£…ï¼Œæä¾›äº†æ›´åŠ å¼€ç®±å³ç”¨çš„`API`ï¼Œç®€åŒ–äº†å¾®å‰ç«¯åº”ç”¨çš„å¼€å‘å’Œé›†æˆæµç¨‹
- **æŠ€æœ¯æ ˆæ— å…³ï¼š** å®Œå…¨ä¸å—æŠ€æœ¯æ ˆé™åˆ¶ï¼Œæ”¯æŒä»»æ„æŠ€æœ¯æ ˆçš„åº”ç”¨æ¥å…¥ï¼ŒåŒ…æ‹¬`React`ã€`Vue`ã€`Angular`ã€`JQuery`ç­‰ï¼Œä½¿å¾—ä¸åŒå›¢é˜Ÿå¯ä»¥ä½¿ç”¨å…¶å–œæ¬¢çš„æ¡†æ¶è¿›è¡Œå¼€å‘
- **HTML Entry æ¥å…¥ï¼š** ä½¿ç”¨`HTML Entry`çš„æ–¹å¼æ¥å…¥å¾®åº”ç”¨ï¼Œç±»ä¼¼äºä½¿ç”¨`iframe`ï¼Œç®€å•æ˜“ç”¨ï¼Œé™ä½äº†é›†æˆéš¾åº¦
- **æ ·å¼å’ŒJSéš”ç¦»ï¼š** å®ç°äº†æ ·å¼éš”ç¦»å’Œ`JS`éš”ç¦»ï¼Œç¡®ä¿å„ä¸ªå¾®å‰ç«¯åº”ç”¨ä¹‹é—´äº’ä¸å½±å“ï¼Œè§£å†³äº†ä¼ ç»Ÿå¾®å‰ç«¯æ¡†æ¶çš„ä¸€äº›éš¾é¢˜
- **èµ„æºé¢„åŠ è½½ï¼š** åœ¨æµè§ˆå™¨ç©ºé—²æ—¶é—´é¢„åŠ è½½æœªæ‰“å¼€çš„å¾®åº”ç”¨èµ„æºï¼Œæå‡äº†å¾®åº”ç”¨æ‰“å¼€é€Ÿåº¦ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚

### å®æˆ˜

**ä¸¾ä¸ªğŸŒ°**

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¾®å‰ç«¯æ¶æ„çš„é¡¹ç›®ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåŸºåº§ï¼ˆä¸»åº”ç”¨ï¼‰å’Œä¸‰ä¸ªå­åº”ç”¨ï¼ˆ`React`ã€`Vue2`ã€`Vue3`ï¼‰ã€‚

é¡¹ç›®åœ°å€ï¼šhttps://github.com/YLiShu/Micro_practice

```shell
|-- qiankun-base // åŸºåº§
|-- qiankun-micro-app1 // reactå­åº”ç”¨ï¼Œcreate-react-appåˆ›å»ºçš„reactåº”ç”¨
|-- qiankun-micro-app2  // Vue2å­åº”ç”¨
|__ sqiankun-micro-app3 // Vue3å­åº”ç”¨
```

- **åŸºåº§ï¼ˆqiankun-baseï¼‰ï¼š** ä¸»è¦è´Ÿè´£é›†æˆæ‰€æœ‰çš„å­åº”ç”¨ï¼Œæä¾›ä¸€ä¸ªå…¥å£ï¼Œèƒ½å¤Ÿè®¿é—®æ‰€éœ€è¦çš„å­åº”ç”¨çš„å±•ç¤ºï¼Œå°½é‡ä¸åŒ…å«å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€‚
- **å­åº”ç”¨ï¼š** æ ¹æ®ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚åˆ’åˆ†çš„æ¨¡å—ï¼Œæ¯ä¸ªå­åº”ç”¨éƒ½æ‰“åŒ…æˆ`umd`æ¨¡å—çš„å½¢å¼ï¼Œä»¥ä¾›åŸºåº§ï¼ˆä¸»åº”ç”¨ï¼‰æ¥åŠ è½½ã€‚

#### åŸºåº§

æ­¤å¤„åŸºåº§ç”¨çš„æ˜¯`create-react-app`è„šæ‰‹æ¶åŠ ä¸Š`antd`ç»„ä»¶åº“æ­å»ºçš„é¡¹ç›®ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©`vue`æˆ–è€…å…¶ä»–æ¡†æ¶ï¼Œä¸€èˆ¬æ¥è¯´ï¼ŒåŸºåº§åªæä¾›åŠ è½½å­åº”ç”¨çš„å®¹å™¨ï¼Œå°½é‡ä¸åŒ…å«å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€‚

**åŸºåº§æ”¹é€ **
- å®‰è£…`qiankun`
```bash
// å®‰è£…qiankun
npm i qiankun -S # æˆ–è€… yarn add qiankun
```
- ä¿®æ”¹å…¥å£æ–‡ä»¶
```js
import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import './index.css';
import App from './App';
import { registerMicroApps, start, initGlobalState } from 'qiankun';

// è¦åŠ è½½çš„å­åº”ç”¨åˆ—è¡¨
const apps = [
  {
    name: 'micro-react', // å­åº”ç”¨åç§°
    entry: '//localhost:3011', // é»˜è®¤ä¼šåŠ è½½è¿™ä¸ªè·¯å¾„ä¸‹çš„htmlï¼Œè§£æé‡Œé¢çš„js
    container: '#micro-app', // åŠ è½½çš„å®¹å™¨
    activeRule: '/micro-react', // åŒ¹é…çš„è·¯ç”±
  },
  {
    name: 'micro-vue2', // å­åº”ç”¨åç§°
    entry: '//localhost:3012', // é»˜è®¤ä¼šåŠ è½½è¿™ä¸ªè·¯å¾„ä¸‹çš„htmlï¼Œè§£æé‡Œé¢çš„js
    container: '#micro-app', // åŠ è½½çš„å®¹å™¨
    activeRule: '/micro-vue2', // åŒ¹é…çš„è·¯ç”±
  },
  {
    name: 'micro-vue3', // å­åº”ç”¨åç§°
    entry: '//localhost:3013', // é»˜è®¤ä¼šåŠ è½½è¿™ä¸ªè·¯å¾„ä¸‹çš„htmlï¼Œè§£æé‡Œé¢çš„js
    container: '#micro-app', // åŠ è½½çš„å®¹å™¨
    activeRule: '/micro-vue3', // åŒ¹é…çš„è·¯ç”±
  }
];

// æ³¨å†Œå­åº”ç”¨

registerMicroApps(apps, {
  beforeLoad: [async app => console.log('before load', app.name)],
  beforeMount: [async app => console.log('before mount', app.name)],
  afterMount: [async app => console.log('after mount', app.name)],
});

const state = { count: 1 };

const actions = initGlobalState(state);
// ä¸»é¡¹ç›®é¡¹ç›®ç›‘å¬å’Œä¿®æ”¹
actions.onGlobalStateChange((state, prev) => {
  // stateï¼šå˜æ›´åçš„çŠ¶æ€ï¼›prevï¼šå˜æ›´å‰çš„çŠ¶æ€
  console.log(state, prev);
})

actions.setGlobalState(state); // è®¾ç½®å…¨å±€çŠ¶æ€

start(); // å¯åŠ¨qiankun

const root = ReactDOM.createRoot(
  document.getElementById('root') as HTMLElement
);
root.render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>
);
```

å½“å¾®åº”ç”¨ä¿¡æ¯æ³¨å†Œå®Œæˆåï¼Œä¸€æ—¦æµè§ˆå™¨`URL`å‘ç”Ÿå˜åŒ–ï¼Œ`qiankun`ä¼šè‡ªåŠ¨è§¦å‘åŒ¹é…é€»è¾‘ã€‚æ‰€æœ‰ç¬¦åˆ`activeRule`è§„åˆ™çš„å¾®åº”ç”¨å°†ä¼šè¢«æ’å…¥åˆ°æŒ‡å®šçš„`container`ä¸­ï¼ŒåŒæ—¶æŒ‰é¡ºåºè°ƒç”¨å¾®åº”ç”¨æš´éœ²å‡ºçš„ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚

- `registerMicroApps(apps, lifeCycles?)`
	- æ³¨å†Œæ‰€æœ‰å­åº”ç”¨ï¼Œ`qiankun`ä¼šæ ¹æ®`activeRule`å»åŒ¹é…å¯¹åº”çš„å­åº”ç”¨å¹¶åŠ è½½
- `start(options?)`
	- å¯åŠ¨`qiankun`ï¼Œå¯ä»¥è¿›è¡Œé¢„åŠ è½½å’Œæ²™ç®±è®¾ç½®

è‡³æ­¤ï¼ŒåŸºåº§çš„æ”¹é€ å®Œæˆã€‚å¦‚æœæ˜¯è€é¡¹ç›®æˆ–å…¶ä»–æ¡†æ¶çš„é¡¹ç›®æƒ³æ”¹æˆå¾®å‰ç«¯çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯ç±»ä¼¼çš„æµç¨‹ã€‚

#### Reactå­åº”ç”¨

ä½¿ç”¨`create-react-app`è„šæ‰‹æ¶åˆ›å»ºï¼Œä¸ºäº†ä¸`eject`æ‰€æœ‰çš„`webpack`é…ç½®ï¼Œä½¿ç”¨`react-app-rewired`å·¥å…·æ¥æ”¹é€ `webpack`é…ç½®ã€‚
- å®‰è£…`qiankun`
- æ”¹é€ å­åº”ç”¨å…¥å£æ–‡ä»¶
```tsx
import './public-path'; // åœ¨é¡¶éƒ¨å¼•å…¥
import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from "react-router-dom";
import './index.css';
import App from './App';

let root: ReactDOM.Root;

// æ¸²æŸ“å‡½æ•°ï¼Œæ¥æ”¶propså‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºå¯¹è±¡
function render(props: any = {}) {
  const { container } = props;

  // åˆ›å»ºæˆ–è·å–æ¸²æŸ“æ ¹èŠ‚ç‚¹
  root = ReactDOM.createRoot(container ? container.querySelector('#root') : document.getElementById('root') as HTMLElement);

  // æ¸²æŸ“ React åº”ç”¨
  root.render(
    <React.StrictMode>

      {/* ä½¿ç”¨BrowserRouteråŒ…è£¹Appç»„ä»¶
        å¦‚æœåº”ç”¨åœ¨qiankunå¾®å‰ç«¯æ¡†æ¶ä¸­è¿è¡Œï¼Œå°†basenameè®¾ç½®ä¸ºrouterBaseï¼Œå¦åˆ™ä½¿ç”¨ é»˜è®¤çš„"/"ä½œä¸ºbasenameã€‚
        è¿™æ˜¯å› ä¸ºåœ¨qiankunä¸­ï¼Œå­åº”ç”¨å¯èƒ½è¢«éƒ¨ç½²åˆ°ä¸åŒçš„è·¯å¾„ä¸‹ï¼Œbasenameç”¨äºæŒ‡å®šåº”ç”¨çš„åŸºç¡€ URLã€‚*/}
      <BrowserRouter basename="/micro-react">
        <App />
      </BrowserRouter>
    </React.StrictMode>
  );
}

// å¦‚æœéqiankunå¾®å‰ç«¯æ¡†æ¶ç¯å¢ƒï¼Œåˆ™æ‰§è¡Œæ¸²æŸ“
if (!(window as any).__POWERED_BY_QIANKUN__) {
  render();
}

/**
 * å¾®å‰ç«¯çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° - bootstrap
 * ç”¨äºåˆå§‹åŒ–åº”ç”¨ç¨‹åº
 */
export async function bootstrap() {
  console.log("[react18] react app bootstraped");
}

/**
 * å¾®å‰ç«¯çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° - mount
 * ç”¨äºæŒ‚è½½åº”ç”¨ç¨‹åºåˆ°æŒ‡å®šå®¹å™¨
 * @param props - å¾®å‰ç«¯ä¼ é€’çš„å±æ€§
 */
export async function mount(props: any) {
  console.log("[react18] props from main framework", props);
  render(props);
}

/**
 * å¾®å‰ç«¯çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° - unmount
 * ç”¨äºå¸è½½åº”ç”¨ç¨‹åº
 * @param props - å¾®å‰ç«¯ä¼ é€’çš„å±æ€§
 */
export async function unmount(props: any) {
  root?.unmount()
}
```

- åœ¨`src`ä¸‹æ–°å¢`public-path.js`
```js
/* eslint-disable no-undef */

// å¦‚æœåº”ç”¨åœ¨qiankunå¾®å‰ç«¯æ¡†æ¶ä¸­è¿è¡Œï¼Œåˆ™è®¾ç½® webpack çš„ publicPath,é˜²æ­¢èµ„æºåŠ è½½å‡ºé”™
if (window.__POWERED_BY_QIANKUN__) {
    __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;
}
```

- ä¿®æ”¹`webpack`é…ç½®æ–‡ä»¶
```js
/* config-overrides.js */

// å¼•å…¥åŒ…åç§°
const { name } = require("./package");

module.exports = {
    webpack: (config) => {
        // é…ç½®è¾“å‡ºä¸º UMD æ¨¡å—
        config.output.library = `${name}-[name]`;
        config.output.libraryTarget = 'umd';

        // å¯¹äº webpack 5ï¼Œéœ€è¦å°† jsonpFunction æ›¿æ¢ä¸º chunkLoadingGlobal
        config.output.chunkLoadingGlobal = `webpackJsonp_${name}`;
        config.output.globalObject = 'window';

        return config;
    },
    devServer: (_) => {
        const config = _;

        // é…ç½®è·¨åŸŸå¤´
        config.headers = {
            'Access-Control-Allow-Origin': '*',
        };
        // å¯ç”¨ historyApiFallback æ”¯æŒå•é¡µåº”ç”¨è·¯ç”±
        config.historyApiFallback = true;
        // å…³é—­çƒ­æ›´æ–°
        config.hot = false;
        // å…³é—­å†…å®¹è§‚å¯Ÿï¼Œæé«˜æ€§èƒ½
        config.watchContentBase = false;
        // å…³é—­å®æ—¶é‡æ–°åŠ è½½
        config.liveReload = false;

        return config;
    },
};
```

#### Vue2å­åº”ç”¨

##### åˆ›å»ºå­åº”ç”¨

```bash
# åˆ›å»ºå­åº”ç”¨ï¼Œé€‰æ‹©vue2
npm create qiankun-micro-app2
```

##### æ”¹é€ å­åº”ç”¨

- å®‰è£…`qiankun`
- æ”¹é€ å­åº”ç”¨å…¥å£
```js
import './public-path';
import router from './router';
import Vue from 'vue';
import App from './App.vue';

Vue.config.productionTip = false;

let instance = null;

function render(props = {}) {
  const { container } = props;

  instance = new Vue({
    router,
    render: (h) => h(App)
  }).$mount(container ? container.querySelector('#app') : '#app');
}

// ç‹¬ç«‹è¿è¡Œæ—¶
if (!window.__POWERED_BY_QIANKUN__) {
  render();
}

export async function bootstrap() {
  console.log('[vue] vue2.0 app bootstraped');
}
export async function mount(props) {
  console.log('[vue] props from main framework', props);
  render(props);
}
export async function unmount() {
  instance.$destroy();
  instance.$el.innerHTML = '';
  instance = null;
}
```

- åœ¨`src`ä¸‹æ–°å¢`public-path.js`
```js
/* eslint-disable no-undef */
if (window.__POWERED_BY_QIANKUN__) {
    __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;
}
```

- ä¿®æ”¹`vue.config.js`
```js
const { defineConfig } = require('@vue/cli-service');
const { name } = require('./package');

// å®šä¹‰ç«¯å£å·
const port = 3012;

module.exports = defineConfig({
  transpileDependencies: true,
  lintOnSave: false,
  devServer: {
    // æŒ‡å®šç«¯å£å·
    port,
    // è®¾ç½®è·¨åŸŸè¯·æ±‚å¤´
    headers: {
      'Access-Control-Allow-Origin': '*',
    },
  },
  configureWebpack: {
    output: {
      library: `${name}-[name]`,
      libraryTarget: 'umd', // æŠŠå¾®åº”ç”¨æ‰“åŒ…æˆ umd åº“æ ¼å¼
      chunkLoadingGlobal: `webpackJsonp_${name}`, // webpack 5 éœ€è¦æŠŠ jsonpFunction æ›¿æ¢æˆ chunkLoadingGlobal
    },
  },
})
```

#### Vue3å­åº”ç”¨

##### åˆ›å»ºå­åº”ç”¨

```bash
# åˆ›å»ºå­åº”ç”¨ï¼Œé€‰æ‹©vue3
npm create qiankun-micro-app3
```

##### æ”¹é€ å­åº”ç”¨

- å®‰è£…`qiankun`
- æ”¹é€ å­åº”ç”¨å…¥å£
```ts
import './public-path';
import { createApp } from 'vue';
import App from './App.vue';
import router from './router';

// å®šä¹‰ instance å˜é‡çš„ç±»å‹ä¸º createApp çš„è¿”å›ç±»å‹æˆ– null
let instance: ReturnType<typeof createApp> | null = null;

// æ¸²æŸ“å‡½æ•°ï¼Œæ¥æ”¶ props å‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºå¯¹è±¡
function render(props: any = {}) {
    console.log(props);
    const { container } = props;

    // åˆ›å»º Vue åº”ç”¨å®ä¾‹
    instance = createApp(App);

    // å°†åº”ç”¨æŒ‚è½½åˆ°æŒ‡å®šå®¹å™¨æˆ– '#app'
    instance.use(router).mount(container ? container.querySelector('#app') : '#app');
}

// å¦‚æœéqiankunå¾®å‰ç«¯ç¯å¢ƒï¼Œç›´æ¥æ‰§è¡Œæ¸²æŸ“å‡½æ•°
if (!(window as any).__POWERED_BY_QIANKUN__) {
    render();
}

// å¾®å‰ç«¯ç”Ÿå‘½å‘¨æœŸ - bootstrap é˜¶æ®µ
export async function bootstrap() {
    console.log('[vue] vue3.0 app bootstraped');
}

// å¾®å‰ç«¯ç”Ÿå‘½å‘¨æœŸ - mount é˜¶æ®µ
export async function mount(props: any = {}) {
    console.log(props);
    // æ‰§è¡Œæ¸²æŸ“å‡½æ•°ï¼Œå¹¶ä¼ é€’ props
    render(props);

    // å°†å…¨å±€çŠ¶æ€ç®¡ç†æ–¹æ³•ç»‘å®šåˆ° Vue åº”ç”¨å®ä¾‹çš„å…¨å±€å±æ€§ä¸­
    instance!.config.globalProperties.$onGlobalStateChange = props.onGlobalStateChange;
    instance!.config.globalProperties.$setGlobalState = props.setGlobalState;
}

// å¾®å‰ç«¯ç”Ÿå‘½å‘¨æœŸ - unmount é˜¶æ®µ
export async function unmount() {
    // å¸è½½åº”ç”¨
    instance!.unmount();
    // æ¸…ç©ºå®¹å™¨å†…çš„å†…å®¹
    instance!._container!.innerHTML = '';
    instance = null;
}
```

- åœ¨`src`ä¸‹æ–°å¢`public-path.js`
```js
/* eslint-disable no-undef */
if (window.__POWERED_BY_QIANKUN__) {
    __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;
}
```

- ä¿®æ”¹`vue.config.js`
```js
const { defineConfig } = require('@vue/cli-service');
const { name } = require('./package');

// å®šä¹‰ç«¯å£å·
const port = 3013;

// å¯¼å‡ºé…ç½®
module.exports = defineConfig({
  // å…è®¸ä½¿ç”¨ ES Module è¯­æ³•
  transpileDependencies: true,
  lintOnSave: false,
  // é…ç½®å¼€å‘æœåŠ¡å™¨
  devServer: {
    // æŒ‡å®šç«¯å£å·
    port,
    // è®¾ç½®è·¨åŸŸè¯·æ±‚å¤´
    headers: {
      'Access-Control-Allow-Origin': '*',
    },
  },

  // é…ç½® webpack
  configureWebpack: {
    // è®¾ç½®è¾“å‡ºé…ç½®
    output: {
      // å®šä¹‰è¾“å‡ºçš„åº“åç§°
      library: `${name}-[name]`,
      // å®šä¹‰è¾“å‡ºçš„åº“çš„ç›®æ ‡
      libraryTarget: 'umd',
      // è®¾ç½® chunk åŠ è½½æ—¶ä½¿ç”¨çš„å…¨å±€å˜é‡å
      chunkLoadingGlobal: `webpackJsonp_${name}`,
    },
  },
});
```

#### æ€»ç»“

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†åº”ç”¨çš„åŠ è½½ï¼Œå·²ç»è¦†ç›–äº†reactå’Œvueä¸¤å¤§æ¡†æ¶ï¼Œangularå’Œjqueryçš„é¡¹ç›®ä¹Ÿæ˜¯åŒç†ã€‚

### è¿›é˜¶çŸ¥è¯†

#### æ ·å¼éš”ç¦»

`qiankun`å®ç°äº†å„ä¸ªå­åº”ç”¨ä¹‹é—´çš„æ ·å¼éš”ç¦»ï¼Œä½†åŸºåº§å’Œå­åº”ç”¨ä¹‹é—´çš„æ ·å¼éš”ç¦»å°šæœªå®ç°ï¼Œå¯èƒ½å­˜åœ¨å†²çªå’Œè¦†ç›–æƒ…å†µã€‚

è§£å†³æ–¹æ³•ï¼š
- æ¯ä¸ªåº”ç”¨çš„æ ·å¼ä½¿ç”¨å›ºå®šçš„æ ¼å¼
- é€šè¿‡`css-module`çš„æ–¹å¼ç»™æ¯ä¸ªåº”ç”¨è‡ªåŠ¨åŠ ä¸Šå‰ç¼€

#### å­åº”ç”¨é—´çš„è·³è½¬

- ä¸»åº”ç”¨å’Œå¾®åº”ç”¨éƒ½ä½¿ç”¨`hash`æ¨¡å¼æ—¶ï¼Œä¸»åº”ç”¨æ ¹æ®`hash`æ¥åˆ¤æ–­å¾®åº”ç”¨ï¼Œä¸ç”¨å¤„ç†è·³è½¬é—®é¢˜ã€‚
- åœ¨`history`æ¨¡å¼ä¸‹ï¼Œå¾®åº”ç”¨ä¹‹é—´çš„è·³è½¬æˆ–å¾®åº”ç”¨è·³ä¸»åº”ç”¨é¡µé¢ï¼Œç›´æ¥ä½¿ç”¨å¾®åº”ç”¨çš„è·¯ç”±å®ä¾‹æ˜¯ä¸è¡Œçš„ã€‚åŸå› æ˜¯å¾®åº”ç”¨çš„è·¯ç”±å®ä¾‹è·³è½¬åŸºäºè·¯ç”±çš„ `base`ã€‚è§£å†³æ–¹æ¡ˆï¼š
	- ä½¿ç”¨`history.pushState()`
	- å°†ä¸»åº”ç”¨çš„è·¯ç”±å®ä¾‹é€šè¿‡`props`ä¼ ç»™å¾®åº”ç”¨ï¼Œå¾®åº”ç”¨é€šè¿‡è¿™ä¸ªè·¯ç”±å®ä¾‹è·³è½¬ã€‚
	        

å…·ä½“æ–¹æ¡ˆï¼šåœ¨åŸºåº§ä¸­å¤å†™å¹¶ç›‘å¬`history.pushState()`æ–¹æ³•å¹¶åšç›¸åº”çš„è·³è½¬é€»è¾‘

```ts
// é‡å†™å‡½æ•°  
const _wr = function (type: string) {  
 Â const orig = (window as any).history[type]  
 Â return function () {  
 Â  Â const rv = orig.apply(this, arguments)  
 Â  Â const e: any = new Event(type)  
 Â  Â e.arguments = arguments  
 Â  Â window.dispatchEvent(e)  
 Â  Â return rv  
  }  
}  
â€‹  
window.history.pushState = _wr('pushState')  
â€‹  
// åœ¨è¿™ä¸ªå‡½æ•°ä¸­åšè·³è½¬åçš„é€»è¾‘  
const bindHistory = () => {  
 Â const currentPath = window.location.pathname;  
 Â setSelectedPath(  
    routes.find(item => currentPath.includes(item.key))?.key || ''  
  )  
}  
â€‹  
// ç»‘å®šäº‹ä»¶  
window.addEventListener('pushState', bindHistory)
```

#### å…¬å…±ä¾èµ–åŠ è½½

åœºæ™¯ï¼šä¸»åº”ç”¨å’Œå­åº”ç”¨éƒ½ä½¿ç”¨ç›¸åŒçš„åº“æˆ–åŒ…ï¼ˆå¦‚`antd`ã€`axios`ç­‰ï¼‰æ—¶ï¼Œå¯ä»¥é€šè¿‡`externals`çš„æ–¹å¼å¼•å…¥ï¼Œå‡å°‘èµ„æºæµªè´¹ã€‚

æ–¹å¼ï¼š
- ä¸»åº”ç”¨ï¼šé…ç½®`webpack`çš„`externals`ï¼Œå¹¶åœ¨`index.html`ä¸­ä½¿ç”¨å¤–é“¾å¼•å…¥è¿™äº›ä¾èµ–ã€‚
- å­åº”ç”¨ï¼šåŒæ ·é…ç½®`webpack`çš„`externals`ï¼Œå¹¶åœ¨`index.html`ä¸­ä½¿ç”¨å¤–é“¾å¼•å…¥è¿™äº›ä¾èµ–ã€‚æ³¨æ„ï¼Œéœ€è¦ç»™å­åº”ç”¨çš„å…¬å…±ä¾èµ–åŠ ä¸Š`ignore`å±æ€§ï¼ˆè‡ªå®šä¹‰å±æ€§ï¼Œéæ ‡å‡†å±æ€§ï¼‰ï¼Œ`qiankun`åœ¨è§£ææ—¶å‘ç°`ignore`å±æ€§ä¼šè‡ªåŠ¨å¿½ç•¥ã€‚

ä»¥`axios`ä¸ºä¾‹ï¼š

```js
// ä¿®æ”¹config-overrides.js  
const { override, addWebpackExternals } = require('customize-cra')  
â€‹  
module.exports = override(  
 Â addWebpackExternals ({  
 Â  Â axios: "axios",  
  }),  
)
```

```js
<!-- æ³¨æ„ï¼šè¿™é‡Œçš„å…¬å…±ä¾èµ–çš„ç‰ˆæœ¬å¿…é¡»ä¸€è‡´ -->  
<script ignore="true" src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
```

#### å…¨å±€çŠ¶æ€ç®¡ç†

è™½ç„¶å„å­åº”ç”¨åº”å°½é‡é¿å…é€šä¿¡ï¼Œä½†å¦‚æœæ¶‰åŠåˆ°å…¬å…±çŠ¶æ€æˆ–æ“ä½œï¼Œ`qiankun`ä¹Ÿæä¾›äº†æ”¯æŒã€‚

`qinkun`é€šè¿‡å…¨å±€çš„`GlobalState`æ¥å…±äº«æ•°æ®ã€‚åŸºåº§åˆå§‹åŒ–åï¼Œå­åº”ç”¨å¯ä»¥ç›‘å¬å¹¶ä¿®æ”¹è¿™ä¸ªæ•°æ®ã€‚

åŸºåº§ï¼š
```js
// åŸºåº§åˆå§‹åŒ–  
import { initGlobalState } from 'qiankun';  
const actions = initGlobalState(state);  
// ä¸»é¡¹ç›®é¡¹ç›®ç›‘å¬å’Œä¿®æ”¹  
actions.onGlobalStateChange((state, prev) => {  
 Â // state: å˜æ›´åçš„çŠ¶æ€; prev å˜æ›´å‰çš„çŠ¶æ€  
 Â console.log(state, prev);  
});  
actions.setGlobalState(state);
```


å­åº”ç”¨ï¼š
```js
// å­é¡¹ç›®ç›‘å¬å’Œä¿®æ”¹  
export function mount(props) {  
 Â props.onGlobalStateChange((state, prev) => {  
 Â  Â // state: å˜æ›´åçš„çŠ¶æ€; prev å˜æ›´å‰çš„çŠ¶æ€  
 Â  Â console.log(state, prev);  
  });  
 Â props.setGlobalState(state);  
}
```